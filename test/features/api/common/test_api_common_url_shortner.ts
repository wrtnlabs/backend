import axios from "axios";
import typia from "typia";

import { IShortLink } from "@wrtnlabs/os-api/lib/structures/common/IShortLink";

import { HubConfiguration } from "../../../../src/HubConfiguration";

// import { HubGlobal } from "../../../../src/HubGlobal";

export const test_api_common_url_shortner = async () => {
  const host: string = `http://127.0.0.1:${HubConfiguration.API_PORT()}`;
  const res = await axios.post(`${host}/url/shorten`, {
    originalUrl:
      "https://www.google.com/travel/clk/f?u=EqMdCgJMShoECAMQAUKEBQoCS1ISAmtvGhIzOTY5NDM0ODQwMzAxODQ3OTAiA0tSVygAOgUIw__SIjoFCInZxy5AowFA3wFAHUAeQIwCQNECQL4CQOACQNgCQOECQPsCQO0CQIQDQOwCQJQDQO8CQJgDQJsDSABQAVgAYoEBTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNjA1LjEuMTUgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzE2LjQuMSBTYWZhcmkvNjA1LjEuMTUsZ3ppcChnZmUpiAEAogEYTUlTU0lOR19FWEVDVVRJT05fUkVTVUxUwgFsQ2pSSWVubENTVFpPUVVaUk5sbEJVMGhyYzJkQ1J5MHRMUzB0TFMwdExYWjBjM1V4T0VGQlFVRkJSMkUxYmt4WlIwZFdXVzFCRWdkTVNqSXpNaU14R2dzSTBMTU5FQUFhQTB0U1Z6Z2NjSTE50gGEAmh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vdHJhdmVsL2ZsaWdodHM_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_qAGAAqoDM0oCQlBSAzAwMVoCS1JyDAoFMjUwMDASA0tSV3oMCgUyNTAwMBIDS1JX2gEHQVBQTElFRKoDMkoCWVJSAUZyDAoFMjYuMDASA1VTRHoMCgUzNjAwMBIDS1JX2gEHQVBQTElFROIBAkxKqgMySgJTV1IDMDAxWgJKUHILCgQyNzgwEgNKUFl6DAoFMjYxMDASA0tSV9oBB0FQUExJRUSqAzBKAk9JUgMwMDFaAkpQcgoKAzMyMBIDSlBZegsKBDMxMDASA0tSV9oBB0FQUExJRUSqAzFKAlRLUgMwMDFaAkpQcgsKBDEwMDASA0pQWXoLCgQ5NDAwEgNLUlfaAQdBUFBMSUVEggQDCgEwigQ5EAIgDCicATIwQ2hhbmdlcyB0byB0aGlzIHRpY2tldCB3aWxsIGluY3VyIGEgcGVuYWx0eSBmZWUuigQ9EAIgNSgXMjVDYW5jZWxsYXRpb24gb2YgdGhpcyB0aWNrZXQgd2lsbCBpbmN1ciBhIHBlbmFsdHkgZmVlLtgEAKIFFAoGCAAQABgACgYIABABGAASAhABigIECgJMSsACAPICATDyAgEx8gIBMnoLCgRJVEFBEB46ATCCAQsI0LMNEAAaA0tSV5IBBBABKAqYATKiATRIOGNUZ3U2Z1Nqd0VBQ09UMlFCRC0tLS0tLS0tLW9rcXMxM0FBQUFBR2E1bkw4TGpPdXVBugEECAIQAcABf8ABowHAAZECwAFwwAH1AcABiwHAAbYBwAHZAcAB_gHAAZQBwAGmAcAB4wHAAeIBwAGDAsABhQHAAfMBwAHcAcAB7QHAAbQBwAGaAcAB4QHAAasBwAFJwAF2wAGsAcABtwHAAYECwAHrAcAB5wHAAfABwAH4AcAB9wHAAYQCwAH2AcAB3QHAAacBwAGQAsAB-gHAAbEBwAFswAHSAcAB6QHAAe8BwAGFAsoBCwjQsw0QABoDS1JX2gEA8AEBiAIAmgIfGgNTRUwiAktSKgNTRUwyAktSQACiAQNLUlfSAQJMSqICAKoCJwoLCNCzDRAAGgNLUlcaCwjQsw0QABoDS1JXQgsI0LMNEAAaA0tSV-ACAOgCAfgCAZID8gUKrgMK1AEKjwEKSggAGgM3NzIiA0lDTioDS0lYMgcKAkxKEO8BQhYyMDI0LTA5LTA3VDE2OjA1KzA5OjAwShYyMDI0LTA5LTA3VDE4OjAwKzA5OjAwEAAaAkxKIO8BKgNJQ04yA0tJWDoWMjAyNC0wOS0wN1QxNjowNSswOTowMEIWMjAyNC0wOS0wN1QxODowMCswOTowMBIDSUNOGgNLSVgiFjIwMjQtMDktMDdUMTY6MDUrMDk6MDAqFjIwMjQtMDktMDdUMTg6MDArMDk6MDAyAkxKOABAAArUAQqPAQpKCAAaAzc3MiIDS0lYKgNJQ04yBwoCTEoQ6AFCFjIwMjQtMDktMTBUMTA6NDArMDk6MDBKFjIwMjQtMDktMTBUMTI6MzUrMDk6MDAQABoCTEog6AEqA0tJWDIDSUNOOhYyMDI0LTA5LTEwVDEwOjQwKzA5OjAwQhYyMDI0LTA5LTEwVDEyOjM1KzA5OjAwEgNLSVgaA0lDTiIWMjAyNC0wOS0xMFQxMDo0MCswOTowMCoWMjAyNC0wOS0xMFQxMjozNSswOTowMDICTEo4AUAAEgsIwKkHEAAaA0tSVxoLCNCzDRAAGgNLUlciCQgAEAAaA0tSVyoLCJCKBhAAGgNLUlcyBAoCTEo6hgIKCwjQsw0QABoDS1JXEgsIwKkHEAAaA0tSVxoLCJCKBhAAGgNLUlciHAoBWhIEWktSVBgBIgQIABAAKgYIABAAGAAyATQiHAoBUxIEU0tSVBgBIgQIABABKgYIABABGAAyATEyCBIEWktSVDgAMggSBFNLUlQ4ADoaCgsIqMMBEAAaA0tSVxoCQlAqB0FQUExJRUQ6GgoLCKCZAhAAGgNLUlcaAllSKgdBUFBMSUVEOhoKCwj0ywEQABoDS1JXGgJTVyoHQVBQTElFRDoZCgoInBgQABoDS1JXGgJPSSoHQVBQTElFRDoZCgoIuEkQABoDS1JXGgJUSyoHQVBQTElFREIDCgEwmgMJCgRJVEFBEgEwqgMCKAG6AyIKHhgBKgIIASoCCAEyDAoCCAASAggAGgIIA0IEKAEwABAA",
  });
  typia.assertGuard<IShortLink.IResponse>(res.data);

  const redirect = await axios.get(`${host}/url/${res.data.code}`, {
    maxRedirects: 0, // 자동 redirect 비활성화 -> 리다이렉션 응답만 확인
    validateStatus: (status) => status === 301,
  });
  if (
    redirect.headers.location.startsWith("https://www.google.com") === false
  ) {
    throw new Error("Invalid redirect");
  }
};
